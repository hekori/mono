upstream backend_server {
  server localhost:8000 fail_timeout=0;
  # server unix:/webapps/traqrcode_com/run/daphne.sock fail_timeout=0;
}


server {

    listen 443 ssl;
    server_name traqrcode.com www.traqrcode.com;
    server_tokens off;

    root /webapps/traqrcode_com/assets/enabled;

    gzip on;
    gzip_vary on;
    gzip_min_length 1240;
    gzip_proxied expired no-cache no-store private auth;
    gzip_types text/plain
               text/css
               application/json
               application/javascript
               application/x-javascript
               text/xml
               application/xml
               application/xml+rss
               application/font-ttf
               application/x-font-ttf
               font/ttf
               text/javascript
               image/svg+xml;


    location ~* \.(ico|css|js|gif|jpeg|jpg|png|woff|ttf|otf|svg|woff2|eot)$ {
       expires max;
       access_log off;
       add_header Pragma public;
       add_header X-Asset "yes";
    }

    location /api {
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto https;
        proxy_set_header Host $http_host;
        proxy_redirect off;
        proxy_pass http://backend_server;
    }

    location / {
        try_files $uri $uri/ /index.html;
        expires           -1;

        # maintenance mode
        if (-f /webapps/traqrcode_com/run/maintenance_mode_active) {
            return 503;
        }
    }

    ssl on;
    ssl_certificate /etc/letsencrypt/live/traqrcode.com/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/traqrcode.com/privkey.pem;
    ssl_protocols        TLSv1 TLSv1.1 TLSv1.2;
    ssl_ciphers          HIGH:!aNULL:!MD5;

    client_max_body_size 4G;

    access_log /webapps/traqrcode_com/logs/nginx_access.log;
    error_log /webapps/traqrcode_com/logs/nginx_error.log;

}
